
---

# SECTION 6: SQL SUBQUERIES

---

## 1. What is a Subquery?

A **subquery** is a **query inside another query**.

- Inner query executes first
- Result is passed to outer query
- Also called **nested query**

ðŸ“Œ Used when the result of one query depends on another query

---

## 2. Types of Subqueries

| Type | Description |
|----|------------|
| Single-row subquery | Returns one value |
| Multi-row subquery | Returns multiple values |
| Multi-column subquery | Returns multiple columns |
| Correlated subquery | Depends on outer query |
| Scalar subquery | Returns single value |

---

## 3. Single-Row Subquery

### Definition
Returns **only one value**.

---

### Example
Find employees earning more than average salary.

```sql
SELECT name, salary
FROM employee
WHERE salary > (
    SELECT AVG(salary) FROM employee
);
```
ðŸ“Œ Operator used: =, >, <


---

4. Multi-Row Subquery

Definition

Returns multiple values.


---

Example
```
Find employees working in IT or HR departments.

SELECT name
FROM employee
WHERE dept_id IN (
    SELECT dept_id
    FROM department
    WHERE dept_name IN ('IT', 'HR')
);
```
ðŸ“Œ Operators used: IN, ANY, ALL


---

5. Subquery Using ANY
```
SELECT name
FROM employee
WHERE salary > ANY (
    SELECT salary FROM employee WHERE dept_id = 10
);
```
âœ”ï¸ Greater than minimum salary in department 10


---

6. Subquery Using ALL
```
SELECT name
FROM employee
WHERE salary > ALL (
    SELECT salary FROM employee WHERE dept_id = 10
);
```
âœ”ï¸ Greater than maximum salary in department 10


---

7. Correlated Subquery (VERY IMPORTANT â­â­â­)

Definition

Subquery depends on outer query and executes once per row.


---

Example

Find employees earning more than average salary of their department.
```
SELECT e.name, e.salary
FROM employee e
WHERE e.salary > (
    SELECT AVG(salary)
    FROM employee
    WHERE dept_id = e.dept_id
);
```
ðŸ“Œ Slower than normal subquery
ðŸ“Œ Very common interview question


---

8. EXISTS and NOT EXISTS

Purpose

Checks whether subquery returns rows.


---

EXISTS Example
```
SELECT name
FROM employee e
WHERE EXISTS (
    SELECT 1
    FROM department d
    WHERE d.dept_id = e.dept_id
);
```
âœ”ï¸ Returns employees with valid departments


---

NOT EXISTS Example
```
SELECT name
FROM employee e
WHERE NOT EXISTS (
    SELECT 1
    FROM department d
    WHERE d.dept_id = e.dept_id
);
```
âœ”ï¸ Employees without department


---

9. Subqueries in SELECT Clause (Scalar Subquery)
```
SELECT name,
       (SELECT dept_name
        FROM department d
        WHERE d.dept_id = e.dept_id) AS department
FROM employee e;
```
ðŸ“Œ Must return single value


---

10. Subqueries with INSERT, UPDATE, DELETE

INSERT with Subquery
```
INSERT INTO employee_backup
SELECT * FROM employee WHERE dept_id = 10;
```

---

UPDATE with Subquery
```
UPDATE employee
SET salary = salary + 5000
WHERE dept_id = (
    SELECT dept_id FROM department WHERE dept_name = 'IT'
);
```

---

DELETE with Subquery
```
DELETE FROM employee
WHERE dept_id IN (
    SELECT dept_id FROM department WHERE dept_name = 'HR'
);
```

---

11. Subquery vs JOIN (INTERVIEW FAVORITE â­)

Feature	Subquery	JOIN

Performance	Slower	Faster
Readability	Moderate	Better
Usage	Conditional	Preferred


ðŸ“Œ JOIN is preferred in real-time applications


---

Key Points to Remember

Subquery executes first

Single-row â†’ single value

Multi-row â†’ multiple values

Correlated subqueries are slower

EXISTS is faster than IN for large datasets



---

Interview Questions

Basic

1. What is a subquery?


2. Difference between subquery and JOIN?


3. What is a single-row subquery?




---

Intermediate

4. What is correlated subquery?


5. Difference between IN and EXISTS?


6. Can subqueries be used in SELECT clause?




---

Advanced

7. How many times does correlated subquery execute?


8. Which is faster: IN or EXISTS?


9. Can a subquery return multiple columns?




---

Scenario-Based Questions

Scenario 1

Find employees earning more than company average salary.
```
SELECT name
FROM employee
WHERE salary > (
    SELECT AVG(salary) FROM employee
);
```

---

Scenario 2

Find departments having at least one employee.
```
SELECT dept_name
FROM department d
WHERE EXISTS (
    SELECT 1
    FROM employee e
    WHERE e.dept_id = d.dept_id
);
```

---

Scenario 3

Delete employees not assigned to any department.
```
DELETE FROM employee e
WHERE NOT EXISTS (
    SELECT 1 FROM department d
    WHERE d.dept_id = e.dept_id
);
```

---

Practice Questions

1. Find employee(s) with maximum salary.


2. Find employees who earn more than their department average.


3. List departments with no employees.


4. Increase salary by 10% for employees in IT department using subquery.


5. Delete duplicate records using subquery.
